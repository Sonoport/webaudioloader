/*webaudioloader - v1.0.0 - Tue Dec 09 2014 17:24:21 GMT+0800 (SGT) */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof global?o=global:"undefined"!=typeof self&&(o=self),o.webaudioloader=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){"use strict";function WebAudioLoader(options){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.webAudioLoader)return window.webAudioLoader;this.cache=!0,this.maxCacheSize=1e3,this.onload=null,this.onprogress=null,this.context=options.audioContext||new AudioContext;for(var opt in options)this.hasOwnProperty(opt)&&void 0!==options[opt]&&(this[opt]=options[opt]);this._cachedAudio=[],this._cachedSize=0,window.webAudioLoader=this,this._cacheFlush=function(sizeToClear,sortAlgorithm){"function"!=typeof sortAlgorithm&&(sortAlgorithm=function(a,b){return a.timestamp-b.timestamp}),this._cachedAudio.sort(sortAlgorithm);for(var freedBuffer=0;sizeToClear>freedBuffer;){var removedBuffer=this._cachedAudio.pop();freedBuffer+=this._sizeOfBufferInKB(removedBuffer)}},this._addToCache=function(source,audioBuffer){var sizeOfBuffer=this._sizeOfBufferInKB(audioBuffer);this._cachedSize+sizeOfBuffer>=this.maxCacheSize?this._cacheFlushOldest(sizeOfBuffer):(this._cachedSize=this._cachedSize+sizeOfBuffer,this._cachedAudio.push({source:source,buffer:audioBuffer,timestamp:this.audioContext.currentTime}))},this._sizeOfBufferInKB=function(audioBuffer){return audioBuffer.length*audioBuffer.numberOfChannels*4/1e3},this._loadURLOrFile=function(URL,onprogress,onload){var urlType=Object.prototype.toString.call(URL),request=null;if("[object String]"===urlType)request=new XMLHttpRequest,request.open("GET",URL,!0),request.responseType="arraybuffer";else{if("[object File]"!==urlType&&"[object Blob]"!==urlType)return;request=new FileReader}request.onload=function(){"function"==typeof onload&&onload(null,request.response)},request.onerror=function(){"function"==typeof onload&&onload(new Error("Loading Error"),null)},request.onprogress=function(event){"function"==typeof onprogress&&onprogress(event),"function"==typeof this.onprogress&&this.onprogress(event)},"[object String]"===urlType?request.send():("[object File]"===urlType||"[object Blob]"===urlType)&&request.readAsArrayBuffer(URL)}}WebAudioLoader.prototype.load=function(source,options){var decode=!0,thisLoadCache=!0,thisLoadOnload=options.onload||null,thisLoadOnprogress=options.onload||null;// var startPoint = options.startPoint || 0;
// var endPoint = options.endPoint || 0;
(null!==options.cache||void 0!==options.cache)&&(thisLoadCache=options.cache),(null!==options.decode||void 0!==options.decode)&&(decode=options.decode);var onLoadProxy=function(err,arraybuffer){"function"==typeof thisLoadOnload&&thisLoadOnload(err,arraybuffer),"function"==typeof this.onload&&this.onload(err,arraybuffer)}.bind(this);if(this.cache&&thisLoadCache){var cacheSearch=this.cachedAudio.filter(function(thisCacheItem){return thisCacheItem.source===source?!0:void 0});cacheSearch.length>0&&(console.log("Cache Hit"),onLoadProxy(null,cacheSearch[0].buffer))}this._loadURLOrFile(source,thisLoadOnprogress,function(err,arrayBuffer){err||!decode?onLoadProxy(err,arrayBuffer):this.audioContext.decodeAudioData(arrayBuffer,function(audioBuffer){thisLoadCache&&this.cache&&this._addToCache(source,audioBuffer),onLoadProxy(err,arrayBuffer)}.bind(this),function(){onLoadProxy(new Error("Decoding Error"),null)}.bind(this))}.bind(this))},WebAudioLoader.prototype.flushCache=function(){this._cachedAudio=[],this._cachedSize=0},module.exports=WebAudioLoader},{}]},{},[1])(1)});