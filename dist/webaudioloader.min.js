/*webaudioloader - v1.0.0 - Fri Dec 12 2014 16:44:00 GMT+0800 (SGT) */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof global?o=global:"undefined"!=typeof self&&(o=self),o.webaudioloader=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){"use strict";/*
	constructor
	var wal = new WebAudioLoader({cache : false, maxCacheSize : 1000, onload: function(){}, onprogress: function(){}, context : audioContext })
 */
function WebAudioLoader(options){if(!(this instanceof WebAudioLoader))throw new TypeError("WebAudioLoader constructor cannot be called as a function.");// Singleton using a global reference.
if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.webAudioLoader)return window.webAudioLoader;// setup cache object
this._cachedAudio=null,// Define default local properties
this.cache=!0,this.onload=null,this.onprogress=null,Object.defineProperty(this,"maxCacheSize",{enumerable:!0,configurable:!1,set:function(maxSize){this._cachedAudio&&(this._cachedAudio.max=maxSize)},get:function(){return this._cachedAudio.max}}),// Options parsing.
options=options||{};for(var opt in options)this.hasOwnProperty(opt)&&void 0!==options[opt]&&(this[opt]=options[opt]);this.context=options.audioContext||new AudioContext;// Setup Cache
var cacheOptions={max:options.maxCacheSize||1e3,length:function(audioBuffer){return audioBuffer.length*audioBuffer.numberOfChannels*4/1e3}};this._cachedAudio=require("lru-cache")(cacheOptions),// Resgiter as global
window.webAudioLoader=this,// Helper functions
this._loadURLOrFile=function(URL,onprogress,onload){var urlType=Object.prototype.toString.call(URL),request=null;if("[object String]"===urlType)request=new XMLHttpRequest,request.open("GET",URL,!0),request.responseType="arraybuffer";else{if("[object File]"!==urlType&&"[object Blob]"!==urlType)return;request=new FileReader}request.onload=function(){200===request.status?"function"==typeof onload&&onload(null,request.response):"function"==typeof onload&&onload(new Error("Loading Error"),null)},request.onerror=function(){"function"==typeof onload&&onload(new Error("Loading Error"),null)},request.onprogress=function(event){"function"==typeof onprogress&&onprogress(event),"function"==typeof this.onprogress&&this.onprogress(event)}.bind(this),"[object String]"===urlType?request.send():("[object File]"===urlType||"[object Blob]"===urlType)&&request.readAsArrayBuffer(URL)}}/*
	load method.
	wal.load('http://www.example.com/audio.mp3');
	wal.load([object File]);
	wal.load('http://www.example.com/audio.mp3', {decode: false,cache : false , onload: function(){}, onprogress: function(){}});
 */
WebAudioLoader.prototype.load=function(source,options){var decode=!0,thisLoadCache=!0,thisLoadOnload=options.onload||null,thisLoadOnprogress=options.onprogress||null;// var startPoint = options.startPoint || 0;
// var endPoint = options.endPoint || 0;
thisLoadCache=null!==options.cache&&void 0!==options.cache?options.cache:this.cache,null!==options.decode&&void 0!==options.decode&&(decode=options.decode);var onLoadProxy=function(err,arraybuffer){"function"==typeof thisLoadOnload&&thisLoadOnload(err,arraybuffer),"function"==typeof this.onload&&this.onload(err,arraybuffer)}.bind(this);if(this.cache&&thisLoadCache){var testCache=this._cachedAudio.get(source);if(testCache)return void onLoadProxy(null,testCache)}this._loadURLOrFile(source,thisLoadOnprogress,function(err,arrayBuffer){err||!decode?onLoadProxy(err,arrayBuffer):this.context.decodeAudioData(arrayBuffer,function(audioBuffer){thisLoadCache&&this._cachedAudio.set(source,audioBuffer),onLoadProxy(err,audioBuffer)}.bind(this),function(){onLoadProxy(new Error("Decoding Error"),null)}.bind(this))}.bind(this))},/*
	flushCache method
	Resets and empties the cache.
 */
WebAudioLoader.prototype.flushCache=function(){this._cachedAudio.reset()},module.exports=WebAudioLoader},{"lru-cache":2}],2:[function(require,module){!function(){function hOP(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function naiveLength(){return 1}function LRUCache(options){// Kind of weird to have a default max of Infinity, but oh well.
return this instanceof LRUCache?("number"==typeof options&&(options={max:options}),options||(options={}),this._max=options.max,(!this._max||"number"!=typeof this._max||this._max<=0)&&(this._max=1/0),this._lengthCalculator=options.length||naiveLength,"function"!=typeof this._lengthCalculator&&(this._lengthCalculator=naiveLength),this._allowStale=options.stale||!1,this._maxAge=options.maxAge||null,this._dispose=options.dispose,void this.reset()):new LRUCache(options)}function get(self,key,doUse){var hit=self._cache[key];return hit&&(self._maxAge&&Date.now()-hit.now>self._maxAge?(del(self,hit),self._allowStale||(hit=void 0)):doUse&&use(self,hit),hit&&(hit=hit.value)),hit}function use(self,hit){shiftLU(self,hit),hit.lu=self._mru++,self._lruList[hit.lu]=hit}function trim(self){for(;self._lru<self._mru&&self._length>self._max;)del(self,self._lruList[self._lru])}function shiftLU(self,hit){for(delete self._lruList[hit.lu];self._lru<self._mru&&!self._lruList[self._lru];)self._lru++}function del(self,hit){hit&&(self._dispose&&self._dispose(hit.key,hit.value),self._length-=hit.length,self._itemCount--,delete self._cache[hit.key],shiftLU(self,hit))}// classy, since V8 prefers predictable objects.
function Entry(key,value,lu,length,now){this.key=key,this.value=value,this.lu=lu,this.length=length,this.now=now}// closure for web browsers
"object"==typeof module&&module.exports?module.exports=LRUCache:// just set the global for non-node platforms.
this.LRUCache=LRUCache,// resize the cache when the max changes.
Object.defineProperty(LRUCache.prototype,"max",{set:function(mL){(!mL||"number"!=typeof mL||0>=mL)&&(mL=1/0),this._max=mL,this._length>this._max&&trim(this)},get:function(){return this._max},enumerable:!0}),// resize the cache when the lengthCalculator changes.
Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(lC){if("function"!=typeof lC){this._lengthCalculator=naiveLength,this._length=this._itemCount;for(var key in this._cache)this._cache[key].length=1}else{this._lengthCalculator=lC,this._length=0;for(var key in this._cache)this._cache[key].length=this._lengthCalculator(this._cache[key].value),this._length+=this._cache[key].length}this._length>this._max&&trim(this)},get:function(){return this._lengthCalculator},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"length",{get:function(){return this._length},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0}),LRUCache.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var i=0,k=this._mru-1;k>=0&&i<this._itemCount;k--)if(this._lruList[k]){i++;var hit=this._lruList[k];this._maxAge&&Date.now()-hit.now>this._maxAge&&(del(this,hit),this._allowStale||(hit=void 0)),hit&&fn.call(thisp,hit.value,hit.key,this)}},LRUCache.prototype.keys=function(){for(var keys=new Array(this._itemCount),i=0,k=this._mru-1;k>=0&&i<this._itemCount;k--)if(this._lruList[k]){var hit=this._lruList[k];keys[i++]=hit.key}return keys},LRUCache.prototype.values=function(){for(var values=new Array(this._itemCount),i=0,k=this._mru-1;k>=0&&i<this._itemCount;k--)if(this._lruList[k]){var hit=this._lruList[k];values[i++]=hit.value}return values},LRUCache.prototype.reset=function(){if(this._dispose&&this._cache)for(var k in this._cache)this._dispose(k,this._cache[k].value);this._cache=Object.create(null),// hash of items by key
this._lruList=Object.create(null),// list of items in order of use recency
this._mru=0,// most recently used
this._lru=0,// least recently used
this._length=0,// number of items in the list
this._itemCount=0},// Provided for debugging/dev purposes only. No promises whatsoever that
// this API stays stable.
LRUCache.prototype.dump=function(){return this._cache},LRUCache.prototype.dumpLru=function(){return this._lruList},LRUCache.prototype.set=function(key,value){if(hOP(this._cache,key))// dispose of the old one before overwriting
return this._dispose&&this._dispose(key,this._cache[key].value),this._maxAge&&(this._cache[key].now=Date.now()),this._cache[key].value=value,this.get(key),!0;var len=this._lengthCalculator(value),age=this._maxAge?Date.now():0,hit=new Entry(key,value,this._mru++,len,age);// oversized objects fall out of cache automatically.
// oversized objects fall out of cache automatically.
return hit.length>this._max?(this._dispose&&this._dispose(key,value),!1):(this._length+=hit.length,this._lruList[hit.lu]=this._cache[key]=hit,this._itemCount++,this._length>this._max&&trim(this),!0)},LRUCache.prototype.has=function(key){if(!hOP(this._cache,key))return!1;var hit=this._cache[key];return this._maxAge&&Date.now()-hit.now>this._maxAge?!1:!0},LRUCache.prototype.get=function(key){return get(this,key,!0)},LRUCache.prototype.peek=function(key){return get(this,key,!1)},LRUCache.prototype.pop=function(){var hit=this._lruList[this._lru];return del(this,hit),hit||null},LRUCache.prototype.del=function(key){del(this,this._cache[key])}}()},{}]},{},[1])(1)});